# 覆盖索引

为了彻底告别`回表`操作带来的性能损耗，建议：<span style="color:red">最好在查询列表里只包含索引列</span>，比如这样：

```mysql
SELECT name, birthday, phone_number FROM person_info WHERE name > 'Asa' AND name < 'Barlow'
```

因为只查询`name`, `birthday`, `phone_number`这三个索引列的值，所以在通过`idx_name_birthday_phone_number`索引得到结果后<span style="color:blue">就不必到`聚簇索引`中再查找记录的剩余列，这样就省去了`回表`操作带来的性能损耗</span>。把这种只需要用到索引的查询方式称为<span style="color:blue">索引覆盖</span>。排序操作也优先使用`覆盖索引`的方式进行查询，比方说这个查询：

```mysql
SELECT name, birthday, phone_number FROM person_info ORDER BY name, birthday, phone_number;
```

虽然这个查询中没有`LIMIT`子句，但是采用了`覆盖索引`，所以查询优化器就会直接使用`idx_name_birthday_phone_number`索引进行排序而不需要回表操作了

当然，如果业务需要查询出索引以外的列，那还是以保证业务需求为重。但是<span style="color:red">很不鼓励用`*`号作为查询列表，最好把需要查询的列依次标明</span>

# MySQL为什么建议使用自增主键

<span style="color:blue">表的主键一般都要使用自增id，不建议使用业务 id ，因为使用自增 id 可以避免页分裂</span>

mysql ( mysql 默认为InnoDB 引擎)底层数据结构是 B+ 树，索引其实就是一颗 B+ 树，一个表有多少个索引就会有多少颗 B+ 树，mysql 中的数据都是按顺序保存在 B+ 树上的(所以说索引本身是有序的)。

mysql 在底层又是**以数据页为单位来存储数据的，一个数据页大小默认为 16k**，如果一个数据页存满了，mysql 就会去申请一个新的数据页来存储数据。

如果主键为自增 id 的话，mysql 在写满一个数据页的时候，直接申请另一个新数据页接着写就可以了。

**如果主键是非自增 id，为了确保索引有序，mysql 就需要将每次插入的数据都放到合适的位置上**

当往一个快满或已满的数据页中插入数据时，新插入的数据会将数据页写满，mysql 就需要申请新的数据页，并且把上个数据页中的部分数据挪到新的数据页上。这就造成了**页分裂，大量移动数据的过程是会严重影响插入效率的**

其实对主键 id 还有一个小小的要求，在满足业务需求的情况下，**尽量使用占空间更小的主键 id，因为普通索引的叶子节点上保存的是主键 id 的值，如果主键 id 占空间较大的话，那将会成倍增加 mysql 空间占用大小**

# Reference

- [MySQL是怎么运行的：从根儿上理解MySQL](https://juejin.cn/book/6844733769996304392/section/6844733770046636040)

- [MySQL 为什么建议使用自增主键？](https://blog.csdn.net/weixin_39628339/article/details/111278637)







